<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Moving Application</title>
    <link href="css/style.css" rel="stylesheet">
  </head>
  <body>
  
  <div class="container">
    <div class="options-box">
      <h1>Get A Location Array</h1>

      <div>
        <input id="zoom-to-area-text" type="text" placeholder="Enter your favorite area!">
        <input id="zoom-to-area" type="button" value="Zoom">
      </div>

      <input id="show-listings" type="button" value="show">

    </div>
    <div id="map"></div>
  </div>
  <script src="js/libs/jquery.min.js"></script>
  <script>
      // this little experiment show the info can be closed;
      var zoomBtn = document.getElementById('zoom-to-area');
      var zoomInput = document.getElementById('zoom-to-area-text');
      var showBtn = document.getElementById('show-listings');

      let module = {
        locations:[]
      };
      let octopus = {
        setMap:function (map) {
          module.map = map;
        },
        getMap:function () {
          return module.map;
        },
        setLocation:function (item) {
          module.locations.push(item);
        },
        getLocations:function () {
          return module.locations;
        }
      };

      function initMap() {
        let map = new google.maps.Map(document.getElementById('map'), {
          center: {
            lat: 40.7413549, lng: -73.9980244
          },
          zoom: 13,
          mapTypeControl: false
        });
        octopus.setMap(map);

        zoomBtn.addEventListener('click',function () {
          pushLocation();
        });

        showBtn.addEventListener('click',function () {
          createInfowindow();
        });


      }


      function pushLocation(){
        let obj={};
        let address = zoomInput.value;
        let url = `https://maps.googleapis.com/maps/api/geocode/json?address=${address}&key=AIzaSyB9cFpEapXB_PkLQ4eLW5I5IzIJCJ-HSiQ`;
        $.getJSON(url,(data)=>{
          if(data.status === "OK"){
            obj.address = address;
            obj.location = data.results[0].geometry.location;
            octopus.setLocation(obj);
          }else{
            window.alert('We could not find that location - try entering a more' +
                    ' specific place.');
          }

        }).error(function(e){
          window.alert('net work error');
        });

      }

      function createInfowindow(){
        let map = octopus.getMap();
        let locations = octopus.getLocations();

        console.log(locations);

        for (var i = 0; i < locations.length; i++) {

          var centrum = locations[i].location;
          var myLatLng = new google.maps.LatLng(centrum.lat, centrum.lng);

            let marker = new google.maps.Marker({
              position: myLatLng,
              map: map,
              animation: google.maps.Animation.DROP
            });

            let infowindow = new google.maps.InfoWindow({
              content: '<b>Informatie:</b><br>' + locations[i].title
            });

            infowindow.open(map, marker);
            google.maps.event.addListener(marker, 'click', function () {
              this.infowindow.close();
            });
          }
      }

    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9cFpEapXB_PkLQ4eLW5I5IzIJCJ-HSiQ&libraries=places,drawing,geometry&v=3&callback=initMap">
    </script>


  </body>
</html>
